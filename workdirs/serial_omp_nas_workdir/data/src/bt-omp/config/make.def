#---------------------------------------------------------------------------
#
#                SITE- AND/OR PLATFORM-SPECIFIC DEFINITIONS. 
#
#---------------------------------------------------------------------------

#---------------------------------------------------------------------------
# Items in this file will need to be changed for each platform.
#---------------------------------------------------------------------------

#---------------------------------------------------------------------------
# Parallel Fortran:
#
# For CG, EP, FT, MG, LU, SP and BT, which are in Fortran, the following must 
# be defined:
#
# F77        - Fortran compiler
# FFLAGS     - Fortran compilation arguments
# F_INC      - any -I arguments required for compiling Fortran 
# FLINK      - Fortran linker
# FLINKFLAGS - Fortran linker arguments
# F_LIB      - any -L and -l arguments required for linking Fortran 
# 
# compilations are done with $(F77) $(F_INC) $(FFLAGS) or
#                            $(F77) $(FFLAGS)
# linking is done with       $(FLINK) $(F_LIB) $(FLINKFLAGS)
#---------------------------------------------------------------------------

#---------------------------------------------------------------------------
# This is the fortran compiler used for Fortran programs
#---------------------------------------------------------------------------
F77 = pgf90
# This links fortran programs; usually the same as ${F77}
FLINK	= $(F77)

#---------------------------------------------------------------------------
# These macros are passed to the linker 
#---------------------------------------------------------------------------
F_LIB  =

#---------------------------------------------------------------------------
# These macros are passed to the compiler 
#---------------------------------------------------------------------------
F_INC =

#---------------------------------------------------------------------------
# Global *compile time* flags for Fortran programs
#---------------------------------------------------------------------------
FFLAGS	= -O3

#---------------------------------------------------------------------------
# Global *link time* flags. Flags for increasing maximum executable 
# size usually go here. 
#---------------------------------------------------------------------------
FLINKFLAGS = -O3


#---------------------------------------------------------------------------
# Parallel C:
#
# For IS, which is in C, the following must be defined:
#
# CC         - C compiler 
# CFLAGS     - C compilation arguments
# C_INC      - any -I arguments required for compiling C 
# CLINK      - C linker
# CLINKFLAGS - C linker flags
# C_LIB      - any -L and -l arguments required for linking C 
#
# compilations are done with $(CC) $(C_INC) $(CFLAGS) or
#                            $(CC) $(CFLAGS)
# linking is done with       $(CLINK) $(C_LIB) $(CLINKFLAGS)
#---------------------------------------------------------------------------

#---------------------------------------------------------------------------
# This is the C compiler used for C programs

# Intel compiler for Intel spir64
ifeq ($(CCC), icx-pvc)
    CC = icx
    CFLAGS = -O3 -fp-model fast -fno-alias -fiopenmp -fopenmp-targets=spir64 -mcmodel=medium -Wl,--no-relax
    CLINK = icx
    CLINKFLAGS = -O3 -fp-model fast -fno-alias -fiopenmp -fopenmp-targets=spir64 -mcmodel=medium -Wl,--no-relax
    UCC = icx
endif
 
# NVIDIA compiler for NVIDIA A100
ifeq ($(CCC), pgcc-a100)
    CC = pgcc
    CFLAGS = -mp=gpu -gpu=cc80,fastmath -O3 -Minfo=accel -Msafeptr -mcmodel=medium -Wl,--no-relax
    CLINK = $(CC)
    CLINKFLAGS = -mp=gpu -gpu=cc80,fastmath -O3 -Minfo=accel -Msafeptr -mcmodel=medium -Wl,--no-relax
    UCC = pgcc
endif

# NVIDIA compiler for NVIDIA V100
ifeq ($(CCC), pgcc-v100)
    CC = pgcc
    #CFLAGS = -mp
    CFLAGS = -mp=gpu -gpu=cc70,fastmath -O3 -Minfo=accel -Msafeptr -mcmodel=medium -Wl,--no-relax
    CLINK = $(CC)
    #CLINKFLAGS = -mp
    CLINKFLAGS = -mp=gpu -gpu=cc70,fastmath -O3 -Minfo=accel -Msafeptr -mcmodel=medium -Wl,--no-relax
    UCC = pgcc
endif

    
# LLVM compiler for NVIDIA A100
ifeq ($(CCC), clang-a100)
    CC = clang
    CFLAGS = -O3 -fopenmp -fopenmp-targets=nvptx64 --cuda-gpu-arch=sm_80 -mcmodel=medium
    CLINK = clang
    CLINKFLAGS = -O3 -fopenmp -fopenmp-targets=nvptx64 --cuda-gpu-arch=sm_80 -mcmodel=medium
    UCC = clang
endif
    
# LLVM compiler for Intel spir64
ifeq ($(CCC), clang-pvc)
    CC = clang
    CFLAGS = -O3 -fopenmp -fopenmp-targets=spir64 -march=native -mcmodel=medium
    CLINK = clang
    CLINKFLAGS = -O3 -fopenmp -fopenmp-targets=spir64 -march=native -mcmodel=medium
    UCC = clang
endif
    
#---------------------------------------------------------------------------

# OpenUH compiler
ifeq ($(CCC), uhcc)
CC = uhcc
CFLAGS = -accdfa -fopenacc -mcmodel=medium -nvcc,-arch=sm_35,-fmad=false -nvpath,/opt/cuda/5.5/bin/ 
CLINK = $(CC)
CLINKFLAGS = -lopenacc -mcmodel=medium
UCC = gcc
endif

# PGI compiler
ifeq ($(CCC), pgcc)
CFLAGS = -acc -ta=nvidia,cc80,ptxinfo,fastmath -Minfo=accel -Msafeptr -O3 -mcmodel=medium
CC = pgcc
CLINK =$(CC)
CLINKFLAGS = -acc -ta=nvidia,cc80,ptxinfo,fastmath -Minfo=accel -Msafeptr -O3 -mcmodel=medium
UCC = pgcc

endif

# CRAY compiler
ifeq ($(CCC), cc)
CC = cc
CFLAGS = 
CLINK = $(CC)
CLINKFLAGS = 
UCC = cc
endif

# GCC compiler
ifeq ($(CCC), gcc)
CC = gcc
CFLAGS = -O3 -mcmodel=large -fopenacc -foffload=nvptx-none -ffast-math
CLINK = gcc
CLINKFLAGS = -O3 -mcmodel=large -fopenacc -foffload=nvptx-none -foffload=-lm -ffast-math
UCC = gcc
endif

# Intel compiler
ifeq ($(CCC), icc)
CC = icc
CFLAGS = -O3 -mcmodel=medium
CLINK = icc
CLINKFLAGS = -O3 -mcmodel=medium
UCC = icc
endif

# CLACC compiler for NVIDIA A100 (no s2s)
ifeq ($(CCC), clacc-a100)
    CC = /home/yonif/LIGHTBITS/llvm-project/install/bin/clang
    CFLAGS = -fopenacc -fopenmp-targets=nvptx64-nvidia-cuda --cuda-gpu-arch=sm_80 -O3 -mcmodel=medium
    CLINK = $(CC)
    CLINKFLAGS = -fopenacc -fopenmp-targets=nvptx64-nvidia-cuda --cuda-gpu-arch=sm_80 -O3 -mcmodel=medium
    UCC = /home/yonif/LIGHTBITS/llvm-project/install/bin/clang
endif

ifeq ($(CCC), nvcc)
    # Use nvc++ as the C compiler for the benchmark code
    CC = nvcc
    CFLAGS = -O3 

    # Linker is the same as compiler
    CLINK = $(CC)
    CLINKFLAGS = -O3 

    # Utility compiler: use a plain C compiler for tools like setparams.c
    UCC = gcc
endif

# NVIDIA HPC SDK C++ compiler with OpenMP GPU offload (nvc++)
ifeq ($(CCC), nvcpp)
    CC = nvc++
    CFLAGS = -O3 -mp=gpu -gpu=ccall -Minfo=accel -mcmodel=medium
    CLINK = $(CC)
    CLINKFLAGS = -O3 -mp=gpu -gpu=ccall -Minfo=accel -mcmodel=medium
    UCC = gcc
endif

# If CC is explicitly set to nvc++, provide sane defaults for GPU offload
ifeq ($(CC), nvc++)
    CLINK = $(CC)
    CFLAGS ?= -O3 -mp=gpu -gpu=ccall -Minfo=accel -mcmodel=medium
    CLINKFLAGS ?= -O3 -mp=gpu -gpu=ccall -Minfo=accel -mcmodel=medium
    UCC ?= gcc
endif

#---------------------------------------------------------------------------
# These macros are passed to the linker 
#---------------------------------------------------------------------------
C_LIB  = -lm

#---------------------------------------------------------------------------
# These macros are passed to the compiler 
#---------------------------------------------------------------------------
C_INC = -Icommon

#---------------------------------------------------------------------------
# Global *compile time* flags for C programs
#---------------------------------------------------------------------------

#---------------------------------------------------------------------------
# Global *link time* flags. Flags for increasing maximum executable 
# size usually go here. 
#---------------------------------------------------------------------------


#---------------------------------------------------------------------------
# Utilities C:
#
# This is the C compiler used to compile C utilities.  Flags required by 
# this compiler go here also; typically there are few flags required; hence 
# there are no separate macros provided for such flags.
#---------------------------------------------------------------------------


#---------------------------------------------------------------------------
# Destination of executables, relative to subdirs of the main directory. . 
#---------------------------------------------------------------------------
BINDIR	= ./


#---------------------------------------------------------------------------
# The variable RAND controls which random number generator 
# is used. It is described in detail in README.install. 
# Use "randi8" unless there is a reason to use another one. 
# Other allowed values are "randi8_safe", "randdp" and "randdpvec"
#---------------------------------------------------------------------------
#RAND   = randi8
# The following is highly reliable but may be slow:
RAND   = randdp


#---------------------------------------------------------------------------
# The variable WTIME is the name of the wtime source code module in the
# NPB3.x/common directory.  
# For most machines,       use wtime.c
# For SGI power challenge: use wtime_sgi64.c
#---------------------------------------------------------------------------
WTIME  = wtime.c


#---------------------------------------------------------------------------
# Enable if either Cray or IBM: 
# (no such flag for most machines: see common/wtime.h)
# This is used by the C compiler to pass the machine name to common/wtime.h,
# where the C/Fortran binding interface format is determined
#---------------------------------------------------------------------------
# MACHINE	=	-DCRAY
# MACHINE	=	-DIBM
