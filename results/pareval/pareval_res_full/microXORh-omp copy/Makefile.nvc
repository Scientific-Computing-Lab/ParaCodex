# Build microXORh with NVIDIA HPC compiler (nvc++)
CC := nvc++
SM ?= 89
OPTIMIZE ?= yes
DEBUG ?= no
RUN_ARGS ?= 1024 32

program = microXORh.exe
source = main.cpp
obj = $(source:.cpp=.o)

CFLAGS := -cuda -std=c++17 -gpu=cc$(SM)
LDFLAGS := -lcudart

ifeq ($(DEBUG),yes)
  CFLAGS += -g -G
  LDFLAGS += -g -G
else
  ifeq ($(OPTIMIZE),yes)
    CFLAGS += -O3
  endif
endif

$(program): $(obj)
	$(CC) $(CFLAGS) $(obj) -o $@ $(LDFLAGS)

%.o: %.cpp
	$(CC) $(CFLAGS) -c $< -o $@

clean:
	rm -f $(program) $(obj)

run: $(program)
	./$(program) $(RUN_ARGS)
